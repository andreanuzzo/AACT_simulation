---
title: "SIR_basic"
author: "Andrea Nuzzo"
date: `r Sys.date()`
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
home = file.path('~/Documents/MIT')
```

```{r}
library(deSolve)
library(tidyverse)
library(ggthemes)
```

# Basics
Model is:
$\displaystyle \frac{\partial S}{\partial t} = - \beta SI$

$\displaystyle \frac{\partial I}{\partial t} = \beta SI - \gamma I$

$\displaystyle \frac{\partial R}{\partial t} =  \gamma I$

$\beta = cp$

$R0 = cpd$

$S$ = proportion of susceptible individuals in total population
$I$ = proportion of infected individuals in total population
$R$ = proportion of recovered individuals in total population
$\beta$ = transmission parameter (rate of infection for susceptible-infected contact)
$\gamma$ = recovery parameter (rate of infected transitioning to recovered)
$c$ =number of contacts each host has per unit time (contact rate)
$p$ = probability of transmission of infection per contact (transmissibility)
$t$ = evaluation time in days
$d$ = infectious period (days)

# Assumptions
Set conditions as follows:
```{r}
US_pop_2020 = 329410596 # US population based on census
I = 14250/US_pop_2020 # total infected based on [JHU dashboard data](https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6) at March 20
R = 121/US_pop_2020  # total recovered based on [JHU dashboard data](https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6) at March 20
S = 1 - I
d = 14 #estimted contagious asymptomatic
obs_time = 180
R0 = 3.3 # estimated R0
gamm = 1/d # need to check this 
bet = R0/d
```

```{r}
SIR.model <- function(t, b, g){ 
  
  init <- c(S=S,I=I,R=R) 
  parameters <- c(bet=b,gamm=g) 
  time <- seq(0,t,by=t/(2*length(1:t))) 
  
  eqn <- function(time,state,parameters){ 
    with(as.list(c(state,parameters)),{ 
      dS <- -bet*S*I 
      dI <- bet*S*I-gamm*I 
      dR <- gamm*I 
      return(list(c(dS,dI,dR)))}) 
  }
  
  out<-ode(y=init,times=time,eqn,parms=parameters) 
  out.df<-as.data.frame(out) 
}
```

```{r}
SIR.model(obs_time, bet, gamm) %>% 
  as.data.frame() %>% 
  gather(Compartments, value, -time) %>% 
  ggplot() +
  aes(x=time, y= value, color= Compartments) +
  geom_line() +
  theme_clean() + 
  scale_color_pander()
```

